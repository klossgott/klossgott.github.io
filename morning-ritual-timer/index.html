<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morning Ritual Timer - 30 Day Reset Challenge</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            font-family: system-ui, -apple-system, sans-serif; 
        }
        .loading {
            color: white;
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">Loading Morning Ritual Timer...</div>
    </div>

    <script type="text/babel">
        // Constants
        const ELEVEN_API_KEY = 'sk_0f784c61526bd19de89206bf1d1a4e30f698e5bd8b0dd39b';
        const ELEVEN_VOICE_ID = 'WdMh5yw0KuyjyTlKfH2b';
        const GIPHY_API_KEY = 'cOYmv8uODh0R6j65dPvypGTrw0vHO9L5';

        const { useState, useEffect, useRef } = React;
        
        // Simple icon components
        const PlayIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5,3 19,12 5,21" />
            </svg>
        );
        
        const PauseIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="6" y="4" width="4" height="16" />
                <rect x="14" y="4" width="4" height="16" />
            </svg>
        );
        
        const ResetIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                <path d="M3 3v5h5" />
            </svg>
        );

        const VolumeIcon = ({ enabled }) => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11,5 6,9 2,9 2,15 6,15 11,19" />
                {enabled && <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" />}
                {!enabled && <path d="M23 9l-6 6M17 9l6 6" />}
            </svg>
        );

        function MorningRitualTimer() {
            const [currentPhase, setCurrentPhase] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            const [isRunning, setIsRunning] = useState(false);
            const [isCompleted, setIsCompleted] = useState(false);
            const [audioEnabled, setAudioEnabled] = useState(false);
            const [rewardGif, setRewardGif] = useState(null);
            const [dayCount, setDayCount] = useState(1);

            const audioRef = useRef(null);

            // Load saved data
            useEffect(() => {
                try {
                    const savedDays = localStorage.getItem('resetChallengeDays');
                    const savedAudio = localStorage.getItem('audioEnabled');
                    if (savedDays) setDayCount(parseInt(savedDays));
                    if (savedAudio) setAudioEnabled(JSON.parse(savedAudio));
                } catch (e) {
                    console.log('Storage not available');
                }
            }, []);

            const phases = [
                { name: "Light & Hydration", duration: 10, color: "#fef3c7", icon: "â˜€ï¸" },
                { name: "Cool Refresh", duration: 5, color: "#dbeafe", icon: "â„ï¸" },
                { name: "Movement to Music", duration: 10, color: "#dcfce7", icon: "ðŸŽµ" },
                { name: "Nourishing Fuel", duration: 10, color: "#fce7f3", icon: "â˜•" },
                { name: "Gratitude", duration: 10, color: "#ede9fe", icon: "â¤ï¸" },
                { name: "Intentions", duration: 10, color: "#dbeafe", icon: "ðŸŽ¯" },
                { name: "Visualization", duration: 10, color: "#ccfbf1", icon: "ðŸ‘ï¸" }
            ];

            const guidance = [
                "Good morning. Let the light wake you gently. Sip some water slowly.",
                "Feel the cool water invigorate you. Breathe deeply.",
                "Move your body with joy. Dance or stretch as you feel.",
                "Nourish yourself mindfully. Prepare something healthy.",
                "Place your hand on your heart. Feel three things you're grateful for.",
                "What would make today meaningful? Set your intentions.",
                "See yourself moving through today with grace and confidence."
            ];

            // Timer logic
            useEffect(() => {
                let interval = null;
                if (isRunning && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft(prev => prev - 1);
                    }, 1000);
                } else if (isRunning && timeLeft === 0) {
                    if (currentPhase < phases.length - 1) {
                        const nextPhase = currentPhase + 1;
                        setCurrentPhase(nextPhase);
                        setTimeLeft(phases[nextPhase].duration);
                        playAudio(guidance[nextPhase]);
                    } else {
                        completeRitual();
                    }
                }
                return () => clearInterval(interval);
            }, [isRunning, timeLeft, currentPhase]);

            const playAudio = async (text) => {
                if (!audioEnabled) return;
                
                try {
                    // Try ElevenLabs first
                    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${ELEVEN_VOICE_ID}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'xi-api-key': ELEVEN_API_KEY
                        },
                        body: JSON.stringify({
                            text: text,
                            model_id: 'eleven_multilingual_v2'
                        })
                    });
                    
                    if (response.ok) {
                        const audioBuffer = await response.arrayBuffer();
                        const blob = new Blob([audioBuffer], { type: 'audio/mpeg' });
                        const audioUrl = URL.createObjectURL(blob);
                        const audio = new Audio(audioUrl);
                        audio.play();
                        audio.onended = () => URL.revokeObjectURL(audioUrl);
                        console.log('ðŸŽ¤ ElevenLabs voice played');
                        return;
                    }
                } catch (e) {
                    console.log('ElevenLabs failed, using TTS');
                }
                
                // Fallback to browser TTS
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.8;
                    speechSynthesis.speak(utterance);
                }
            };

            const fetchGif = async () => {
                try {
                    const response = await fetch(`https://api.giphy.com/v1/gifs/search?api_key=${GIPHY_API_KEY}&q=celebration&limit=1&rating=g`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.data && data.data[0]) {
                            setRewardGif(data.data[0].images.fixed_height.url);
                            console.log('ðŸŽ‰ GIF loaded');
                        }
                    }
                } catch (e) {
                    console.log('GIF failed');
                }
            };

            const completeRitual = () => {
                setIsCompleted(true);
                setIsRunning(false);
                const newCount = dayCount + 1;
                setDayCount(newCount);
                
                try {
                    localStorage.setItem('resetChallengeDays', newCount.toString());
                } catch (e) {}
                
                playAudio(`Congratulations! You completed your morning ritual. This is day ${newCount} of your journey.`);
                fetchGif();
            };

            const startTimer = () => {
                if (!isRunning && timeLeft === 0) {
                    setTimeLeft(phases[currentPhase].duration);
                }
                setIsRunning(true);
                playAudio(guidance[currentPhase]);
            };

            const pauseTimer = () => setIsRunning(false);

            const resetTimer = () => {
                setIsRunning(false);
                setCurrentPhase(0);
                setTimeLeft(phases[0].duration);
                setIsCompleted(false);
                setRewardGif(null);
            };

            const enableAudio = () => {
                setAudioEnabled(true);
                try {
                    localStorage.setItem('audioEnabled', 'true');
                } catch (e) {}
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            const currentPhase_data = phases[currentPhase];

            if (isCompleted) {
                return (
                    <div className="max-w-md mx-auto rounded-3xl p-8 text-center shadow-2xl" 
                         style={{ backgroundColor: currentPhase_data.color }}>
                        <div className="text-5xl mb-4">ðŸŒ…</div>
                        <h2 className="text-2xl font-light mb-2 text-gray-700">Well done!</h2>
                        <div className="text-6xl font-light text-gray-600 mb-4">{dayCount}</div>
                        <p className="text-lg text-gray-600 mb-6">Days of showing up for yourself</p>
                        
                        {rewardGif && (
                            <div className="mb-6">
                                <img src={rewardGif} alt="Celebration" className="w-48 h-48 mx-auto rounded-lg object-cover" />
                            </div>
                        )}
                        
                        <div className="bg-white/40 rounded-2xl p-6 mb-6">
                            <p className="text-gray-700 mb-4 font-medium">
                                You chose to begin. That's everything.
                            </p>
                            <div className="text-3xl mb-4">âœ¨</div>
                            <p className="text-sm text-gray-600">
                                {dayCount >= 30 ? "Journey complete!" : `${30 - dayCount} more days to go!`}
                            </p>
                        </div>

                        <button
                            onClick={resetTimer}
                            className="w-full bg-white/60 text-gray-700 px-6 py-3 rounded-full font-medium hover:bg-white/80 transition-all duration-300"
                        >
                            Tomorrow Awaits
                        </button>
                    </div>
                );
            }

            return (
                <div className="max-w-md mx-auto rounded-3xl shadow-2xl overflow-hidden transition-all duration-1000" 
                     style={{ backgroundColor: currentPhase_data.color }}>
                    
                    {/* Header */}
                    <div className="bg-white/30 text-gray-700 p-6 text-center">
                        <div className="flex items-center justify-between mb-3">
                            <button
                                onClick={() => setAudioEnabled(!audioEnabled)}
                                className="p-2 rounded-full bg-white/20 hover:bg-white/40 transition-colors"
                            >
                                <VolumeIcon enabled={audioEnabled} />
                            </button>
                            
                            {!audioEnabled && (
                                <button
                                    onClick={enableAudio}
                                    className="px-3 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600"
                                >
                                    Enable Voice ðŸ”Š
                                </button>
                            )}
                            
                            <div className="text-right">
                                <div className="text-sm opacity-70">Day {dayCount} of 30</div>
                                <div className="text-xs opacity-60">Reset Challenge</div>
                            </div>
                        </div>
                        
                        <div className="flex items-center justify-center gap-3 mb-3">
                            <div className="text-3xl">{currentPhase_data.icon}</div>
                            <div>
                                <h1 className="text-2xl font-light">{currentPhase_data.name}</h1>
                                <p className="text-sm opacity-80">Step {currentPhase + 1} of {phases.length}</p>
                            </div>
                        </div>
                    </div>

                    {/* Progress bar */}
                    <div className="bg-gray-200 h-2">
                        <div className="bg-gray-600 h-full transition-all duration-1000 ease-out"
                             style={{ width: `${((currentPhase + 1) / phases.length) * 100}%` }}>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="p-6 space-y-6">
                        <div className="text-center">
                            <div className="text-6xl font-light text-gray-600 mb-4 font-mono">
                                {formatTime(timeLeft)}
                            </div>
                        </div>

                        <div className="bg-white/30 rounded-2xl p-6">
                            <p className="text-gray-600 leading-relaxed text-sm">
                                {guidance[currentPhase]}
                            </p>
                        </div>

                        {/* Controls */}
                        <div className="flex justify-center gap-4">
                            {!isRunning ? (
                                <button
                                    onClick={startTimer}
                                    className="bg-white/50 text-gray-700 px-8 py-4 rounded-full font-medium hover:bg-white/70 transition-all duration-300 flex items-center gap-2"
                                >
                                    <PlayIcon />
                                    Begin Gently
                                </button>
                            ) : (
                                <button
                                    onClick={pauseTimer}
                                    className="bg-white/50 text-gray-700 px-8 py-4 rounded-full font-medium hover:bg-white/70 transition-all duration-300 flex items-center gap-2"
                                >
                                    <PauseIcon />
                                    Pause
                                </button>
                            )}
                            
                            <button
                                onClick={resetTimer}
                                className="bg-white/50 text-gray-600 px-6 py-4 rounded-full font-medium hover:bg-white/70 transition-all duration-300 flex items-center gap-2"
                            >
                                <ResetIcon />
                                Reset
                            </button>
                        </div>

                        {/* Phase dots */}
                        <div className="flex justify-center gap-2">
                            {phases.map((phase, index) => (
                                <button
                                    key={index}
                                    onClick={() => {
                                        setCurrentPhase(index);
                                        setTimeLeft(phases[index].duration);
                                        setIsRunning(false);
                                    }}
                                    className={`w-3 h-3 rounded-full transition-all ${
                                        index === currentPhase 
                                            ? 'bg-gray-600 scale-125' 
                                            : index < currentPhase 
                                                ? 'bg-gray-400' 
                                                : 'bg-gray-300'
                                    }`}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        console.log('Rendering MorningRitualTimer...');
        ReactDOM.render(React.createElement(MorningRitualTimer), document.getElementById('root'));
    </script>
</body>
</html>
