<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wake Up and Rise - 30-Day Reset Challenge</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 16px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .timer-container {
            max-width: 380px;
            width: 100%;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.25);
            transition: background-color 2000ms ease-in-out;
        }

        /* Dynamic phase colors with smooth transitions */
        .phase-light { background-color: #fef3c7; }
        .phase-cool { background-color: #dbeafe; }
        .phase-movement { background-color: #dcfce7; }
        .phase-fuel { background-color: #fce7f3; }
        .phase-gratitude { background-color: #ede9fe; }
        .phase-intentions { background-color: #dbeafe; }
        .phase-visualization { background-color: #ccfbf1; }

        /* Header with glassmorphism */
        .header {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            color: #374151;
            padding: 20px;
            text-align: center;
        }

        .phase-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .phase-icon {
            font-size: 28px;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .phase-icon svg {
            width: 24px;
            height: 24px;
        }

        .phase-title {
            font-size: 22px;
            font-weight: 300;
            margin: 0;
        }

        .phase-step {
            font-size: 13px;
            opacity: 70%;
            margin: 0;
        }

        .day-counter {
            font-size: 11px;
            opacity: 60%;
            margin-top: 8px;
        }

        .audio-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 12px;
        }

        .audio-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .audio-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .audio-btn.enabled {
            background: rgba(255, 255, 255, 0.4);
            color: #374151;
        }

        /* Progress bar */
        .progress-bar {
            background: #e5e7eb;
            height: 4px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #374151 0%, #6b7280 100%);
            height: 100%;
            transition: width 1000ms ease-out;
            position: relative;
        }

        /* Main content */
        .content {
            padding: 24px 20px;
            text-align: center;
        }

        /* Timer display with glow effect */
        .timer-display {
            font-size: 56px;
            font-weight: 100;
            font-family: 'SF Mono', 'Monaco', 'Cascadia Code', monospace;
            color: #374151;
            margin-bottom: 24px;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(55, 65, 81, 0.1);
        }

        /* Guidance box */
        .guidance-box {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .guidance-title {
            font-size: 18px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 12px;
        }

        .guidance-text {
            color: #6b7280;
            line-height: 1.6;
            font-size: 14px;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.4);
            border: none;
            border-radius: 40px;
            padding: 14px 28px;
            color: #374151;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        /* Phase navigation */
        .phase-nav {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 20px;
            margin-top: 20px;
        }

        .phase-nav-title {
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 16px;
        }

        .phase-dots {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .phase-dot {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 12px;
            padding: 10px 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: #6b7280;
        }

        .phase-dot:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .phase-dot.active {
            background: rgba(255, 255, 255, 0.5);
            color: #374151;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .phase-dot.completed {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .phase-dot-icon {
            font-size: 14px;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .phase-dot-icon svg {
            width: 12px;
            height: 12px;
        }

        .phase-dot-number {
            font-size: 9px;
            font-weight: 600;
        }

        /* Completion screen */
        .completion {
            text-align: center;
            padding: 40px 24px;
        }

        .completion-title {
            font-size: 32px;
            font-weight: 300;
            color: #374151;
            margin-bottom: 16px;
        }

        .completion-message {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .celebration-container {
            position: relative;
            margin: 24px 0;
            max-width: 280px;
            margin-left: auto;
            margin-right: auto;
        }

        .celebration-gif img {
            max-width: 100%;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .sticker-overlay {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 60px;
            height: 60px;
            opacity: 0.9;
            pointer-events: none;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Community section */
        .community-section {
            background: rgba(255, 255, 255, 0.25);
            border-radius: 16px;
            padding: 16px;
            margin-top: 20px;
        }

        .community-title {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .community-text {
            font-size: 12px;
            color: #6b7280;
            line-height: 1.5;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .timer-container {
                margin: 10px;
            }
            
            .timer-display {
                font-size: 48px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .phase-dots {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Audio status indicator */
        .audio-status {
            font-size: 10px;
            color: #6b7280;
            margin-top: 8px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="timer-container phase-light" id="timerContainer">
        <!-- Header -->
        <div class="header">
            <div class="phase-info">
                <div class="phase-icon" id="phaseIcon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
                </div>
                <div>
                    <h1 class="phase-title" id="phaseTitle">Light & Hydration</h1>
                    <p class="phase-step" id="phaseStep">Step 1 of 7</p>
                </div>
            </div>
            
            <div class="day-counter" id="dayCounter">Day 1 of 30-Day Reset Challenge</div>
            
            <div class="audio-controls">
                <button class="audio-btn" id="voiceBtn" onclick="toggleVoice()" title="Voice guidance">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                </button>
                <button class="audio-btn" id="musicBtn" onclick="toggleMusic()" title="Background music">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
                </button>
            </div>
            
            <div class="audio-status" id="audioStatus">Click to enable audio 🔊</div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 14.3%"></div>
        </div>

        <!-- Main App -->
        <div class="content" id="app">
            <!-- Timer -->
            <div class="timer-display" id="timerDisplay">10:00</div>

            <!-- Guidance -->
            <div class="guidance-box">
                <div class="guidance-title" id="guidanceTitle">Let the morning light find you.</div>
                <div class="guidance-text" id="guidanceText">
                    Step outside or open those curtains. Let the light touch your face. Sip some water slowly - maybe with a pinch of salt or lemon. This is your sacred time for light, water, and gentle presence. Add yoga or meditation if you wish. Take it slow.
                </div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <button class="control-btn" onclick="startTimer()" id="startBtn">
                    ▶️ Begin Gently
                </button>
                <button class="control-btn" onclick="pauseTimer()" id="pauseBtn" style="display:none">
                    ⏸️ Pause
                </button>
                <button class="control-btn" onclick="resetTimer()" id="resetBtn">
                    🔄 Reset
                </button>
            </div>

            <!-- Phase Navigation -->
            <div class="phase-nav">
                <div class="phase-nav-title">Your morning ritual:</div>
                <div class="phase-dots" id="phaseDots"></div>
            </div>

            <!-- Community Section -->
            <div class="community-section">
                <div class="community-title">
                    💫 Community Support
                </div>
                <div class="community-text">
                    Share your morning playlist with your group! What music helps you start your day with intention? 🎵
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div class="completion" id="completion" style="display:none;">
            <div class="celebration-container" id="celebrationContainer">
                <!-- GIFs and stickers will be inserted here -->
            </div>
            
            <h2 class="completion-title">Well done!</h2>
            <div class="completion-message" id="completionMessage">
                You've completed your morning ritual. You chose to begin. That's everything.
            </div>
            
            <div class="controls">
                <button class="control-btn" onclick="shareProgress()">
                    📱 Share Progress
                </button>
                <button class="control-btn" onclick="resetForTomorrow()">
                    🌅 Tomorrow Awaits
                </button>
            </div>
        </div>

        <!-- Hidden Audio Elements -->
        <audio id="voicePlayer" preload="none"></audio>
        <audio id="musicPlayer" preload="none" loop></audio>
    </div>

    <script>
        // Configuration
        const ELEVEN_API_KEY = 'sk_0f784c61526bd19de89206bf1d1a4e30f698e5bd8b0dd39b';
        const ELEVEN_VOICE_ID = 'WdMh5yw0KuyjyTlKfH2b';
        const GIPHY_API_KEY = 'cOYmv8uODh0R6j65dPvypGTrw0vHO9L5';

        // Piano music files from your GitHub
        const audioFiles = [
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic1.mp3',
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic2.mp3',
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic3.mp3',
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic4.mp3',
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic5.mp3',
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic6.mp3',
            'https://klossgott.github.io/infocusapp/timer/audios/pianomusic7.mp3'
        ];

        const phases = [
            {
                name: 'Light & Hydration',
                duration: 10, // 10 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>',
                color: 'phase-light',
                instructions: 'Let the morning light find you.',
                guidance: 'Step outside or open those curtains. Let the light touch your face. Sip some water slowly - maybe with a pinch of salt or lemon. This is your sacred time for light, water, and gentle presence. Add yoga or meditation if you wish. Take it slow.'
            },
            {
                name: 'Cool Refresh',
                duration: 5, // 5 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/></svg>',
                color: 'phase-cool',
                instructions: 'Here comes your moment of gentle courage.',
                guidance: 'At the end of your warm shower, turn the water cool for just 30 seconds. Breathe slowly and deeply. You\'ve got this.'
            },
            {
                name: 'Movement to Music',
                duration: 10, // 10 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>',
                color: 'phase-movement',
                instructions: 'What song makes your spirit dance?',
                guidance: 'Put on music that lifts your soul. Dance, stretch, sway - however feels good. You\'re waking up joy.'
            },
            {
                name: 'Nourishing Fuel',
                duration: 10, // 10 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/></svg>',
                color: 'phase-fuel',
                instructions: 'What will nourish your body today?',
                guidance: 'Prepare protein mindfully - eggs, yogurt, or a protein shake. This is self-care in action.'
            },
            {
                name: 'Gratitude',
                duration: 10, // 10 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>',
                color: 'phase-gratitude',
                instructions: 'What fills your heart with warmth?',
                guidance: 'Place your hand on your heart. Think of three things you appreciate. Feel that warmth.'
            },
            {
                name: 'Intentions',
                duration: 10, // 10 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>',
                color: 'phase-intentions',
                instructions: 'What would make today meaningful?',
                guidance: 'Consider 1-3 things that matter most today. What would make you feel proud this evening?'
            },
            {
                name: 'Visualization',
                duration: 10, // 10 seconds for testing
                iconSvg: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
                iconSvgSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
                color: 'phase-visualization',
                instructions: 'Can you see yourself moving through today with grace?',
                guidance: 'Close your eyes. See yourself accomplishing your intentions with ease and confidence.'
            }
        ];

        // State variables
        let currentPhase = 0;
        let timeLeft = phases[0].duration;
        let isRunning = false;
        let timer = null;
        let voiceEnabled = false;
        let musicEnabled = false;
        let userInteracted = false;
        let dayCount = parseInt(localStorage.getItem('resetChallengeDays') || '1');

        // Audio elements
        const musicPlayer = document.getElementById('musicPlayer');
        const voicePlayer = document.getElementById('voicePlayer');

        // Completion messages
        const completionMessages = [
            "You did it. You showed up for yourself today.",
            "That's how you start a day with intention.",
            "You've given yourself the gift of presence and strength.",
            "You're building something beautiful, one day at a time.",
            "You chose to begin. That's everything."
        ];

        const startButtonTexts = [
            "Begin Gently",
            "Start Softly", 
            "Begin With Grace",
            "Start Your Ritual",
            "Begin Mindfully"
        ];

        // Initialize on page load
        window.addEventListener('load', function() {
            initializeApp();
            console.log('🌅 Wake Up and Rise - Morning Ritual Timer loaded!');
        });

        // User interaction detection
        function enableUserInteraction() {
            if (!userInteracted) {
                userInteracted = true;
                document.getElementById('audioStatus').textContent = 'Audio ready 🎵';
                console.log('🎯 User interaction detected - audio enabled');
            }
        }

        // Add interaction listeners
        document.addEventListener('click', enableUserInteraction, { once: true });
        document.addEventListener('touchstart', enableUserInteraction, { once: true });
        document.addEventListener('keydown', enableUserInteraction, { once: true });

        function initializeApp() {
            updateDayCounter();
            updateDisplay();
            updatePhaseDots();
            initializeAudio();
        }

        function updateDayCounter() {
            document.getElementById('dayCounter').textContent = `Day ${dayCount} of 30-Day Reset Challenge`;
        }

        function initializeAudio() {
            // Setup music player
            if (musicPlayer) {
                const randomTrack = audioFiles[Math.floor(Math.random() * audioFiles.length)];
                musicPlayer.src = randomTrack;
                musicPlayer.volume = 0.15;
                musicPlayer.addEventListener('loadstart', () => console.log('🎵 Loading music...'));
                musicPlayer.addEventListener('canplay', () => console.log('🎵 Music ready to play'));
                musicPlayer.addEventListener('error', (e) => console.log('🎵 Music error:', e));
            }
        }

        // Toggle voice guidance
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceBtn');
            
            if (voiceEnabled) {
                btn.classList.add('enabled');
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>';
                updateAudioStatus();
            } else {
                btn.classList.remove('enabled');
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19"/><path d="M23 9l-6 6M17 9l6 6"/></svg>';
                updateAudioStatus();
            }
            
            console.log('🎤 Voice guidance:', voiceEnabled ? 'enabled' : 'disabled');
        }

        // Toggle background music
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            const btn = document.getElementById('musicBtn');
            
            if (musicEnabled) {
                btn.classList.add('enabled');
                if (userInteracted && musicPlayer) {
                    musicPlayer.play().then(() => {
                        console.log('🎵 Background music started');
                        updateAudioStatus();
                    }).catch(e => {
                        console.log('🎵 Music play failed:', e.message);
                    });
                }
            } else {
                btn.classList.remove('enabled');
                if (musicPlayer) {
                    musicPlayer.pause();
                    console.log('🎵 Background music paused');
                }
                updateAudioStatus();
            }
        }

        function updateAudioStatus() {
            const status = document.getElementById('audioStatus');
            if (!userInteracted) {
                status.textContent = 'Click to enable audio 🔊';
            } else if (voiceEnabled && musicEnabled) {
                status.textContent = 'Voice + Music enabled 🎵🎤';
            } else if (voiceEnabled) {
                status.textContent = 'Voice guidance enabled 🎤';
            } else if (musicEnabled) {
                status.textContent = 'Background music enabled 🎵';
            } else {
                status.textContent = 'Audio ready (click buttons above) 🔊';
            }
        }

        // Enhanced ElevenLabs voice function
        async function playVoice(text) {
            if (!voiceEnabled || !userInteracted) {
                console.log('🎤 Voice skipped - not enabled or no user interaction');
                return;
            }

            console.log('🎤 Playing voice:', text.substring(0, 50) + '...');

            // Fade music if playing
            if (musicPlayer && !musicPlayer.paused) {
                fadeVolume(musicPlayer, 0.05, 500);
            }

            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${ELEVEN_VOICE_ID}?output_format=mp3_22050_32`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVEN_API_KEY
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: {
                            stability: 0.7,
                            similarity_boost: 0.85,
                            style: 0.6
                        }
                    })
                });

                if (response.ok) {
                    const audioData = await response.arrayBuffer();
                    const audioBlob = new Blob([audioData], { type: 'audio/mpeg' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    voicePlayer.src = audioUrl;
                    voicePlayer.volume = 1.0;
                    
                    voicePlayer.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        // Restore music volume
                        if (musicPlayer && !musicPlayer.paused) {
                            fadeVolume(musicPlayer, 0.15, 500);
                        }
                    };
                    
                    await voicePlayer.play();
                    console.log('🎤 ✅ ElevenLabs voice played successfully');
                } else {
                    throw new Error(`API responded with ${response.status}`);
                }
            } catch (error) {
                console.log('🎤 ❌ ElevenLabs failed, trying browser TTS:', error.message);
                
                // Fallback to browser TTS
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.8;
                    utterance.pitch = 1.0;
                    
                    // Try to find a female voice
                    const voices = speechSynthesis.getVoices();
                    const femaleVoice = voices.find(voice => 
                        voice.name.toLowerCase().includes('female') || 
                        voice.name.toLowerCase().includes('woman') ||
                        voice.name.toLowerCase().includes('samantha') ||
                        voice.name.toLowerCase().includes('karen') ||
                        voice.name.toLowerCase().includes('zira')
                    );
                    
                    if (femaleVoice) {
                        utterance.voice = femaleVoice;
                    }
                    
                    speechSynthesis.speak(utterance);
                    console.log('🎤 Browser TTS fallback used');
                }
                
                // Restore music volume
                if (musicPlayer && !musicPlayer.paused) {
                    fadeVolume(musicPlayer, 0.15, 500);
                }
            }
        }

        // Volume fade utility
        function fadeVolume(audio, target, duration = 500) {
            if (!audio) return;
            
            const stepTime = 50;
            const steps = duration / stepTime;
            const start = audio.volume;
            const diff = target - start;
            let currentStep = 0;
            
            const fadeInterval = setInterval(() => {
                currentStep++;
                audio.volume = Math.max(0, Math.min(1, start + (diff * currentStep) / steps));
                
                if (currentStep >= steps) {
                    clearInterval(fadeInterval);
                    audio.volume = target;
                }
            }, stepTime);
        }

        // Giphy functions
        async function fetchCelebrationGif() {
            const celebrationTerms = [
                'woman celebrating morning',
                'peaceful morning meditation',
                'morning achievement',
                'mindful celebration',
                'self care success'
            ];
            
            try {
                const term = celebrationTerms[Math.floor(Math.random() * celebrationTerms.length)];
                console.log('🎉 Fetching celebration GIF:', term);
                
                const response = await fetch(`https://api.giphy.com/v1/gifs/search?api_key=${GIPHY_API_KEY}&q=${encodeURIComponent(term)}&limit=1&rating=g`);
                
                if (!response.ok) throw new Error(`Giphy API error: ${response.status}`);
                
                const data = await response.json();
                
                if (data.data && data.data.length > 0) {
                    const gifUrl = data.data[0].images.fixed_height.url;
                    
                    const celebrationContainer = document.getElementById('celebrationContainer');
                    celebrationContainer.innerHTML = `
                        <div class="celebration-gif">
                            <img src="${gifUrl}" alt="Celebration" onload="console.log('🎉 Celebration GIF loaded')" onerror="console.log('🎉 GIF failed to load')">
                        </div>
                    `;
                    
                    // Fetch sticker overlay
                    fetchCelebrationSticker();
                    
                    console.log('🎉 ✅ Celebration GIF loaded successfully');
                } else {
                    throw new Error('No GIF results found');
                }
            } catch (error) {
                console.error('🎉 ❌ Celebration GIF error:', error.message);
            }
        }

        async function fetchCelebrationSticker() {
            const stickerTerms = ['thumbs up', 'clapping', 'sparkles', 'confetti', 'heart', 'star'];
            
            try {
                const term = stickerTerms[Math.floor(Math.random() * stickerTerms.length)];
                console.log('✨ Fetching celebration sticker:', term);
                
                const response = await fetch(`https://api.giphy.com/v1/stickers/search?api_key=${GIPHY_API_KEY}&q=${encodeURIComponent(term)}&limit=1&rating=g`);
                
                if (!response.ok) throw new Error(`Giphy stickers API error: ${response.status}`);
                
                const data = await response.json();
                
                if (data.data && data.data.length > 0) {
                    const stickerUrl = data.data[0].images.fixed_height.url;
                    
                    // Add sticker overlay to existing celebration container
                    const celebrationContainer = document.getElementById('celebrationContainer');
                    const existingSticker = celebrationContainer.querySelector('.sticker-overlay');
                    if (existingSticker) existingSticker.remove();
                    
                    const stickerDiv = document.createElement('div');
                    stickerDiv.className = 'sticker-overlay';
                    stickerDiv.innerHTML = `<img src="${stickerUrl}" alt="Celebration sticker" style="width: 100%; height: 100%;" onload="console.log('✨ Sticker loaded')" onerror="console.log('✨ Sticker failed')">`;
                    
                    celebrationContainer.appendChild(stickerDiv);
                    
                    console.log('✨ ✅ Celebration sticker loaded successfully');
                } else {
                    throw new Error('No sticker results found');
                }
            } catch (error) {
                console.error('✨ ❌ Celebration sticker error:', error.message);
            }
        }

        // Timer functions
        function updateDisplay() {
            const phase = phases[currentPhase];
            const container = document.getElementById('timerContainer');
            
            // Update phase colors with smooth transition
            container.className = `timer-container ${phase.color}`;
            
            // Update phase icon
            document.getElementById('phaseIcon').innerHTML = phase.iconSvg;
            document.getElementById('phaseTitle').textContent = phase.name;
            document.getElementById('phaseStep').textContent = `Step ${currentPhase + 1} of ${phases.length}`;
            document.getElementById('guidanceTitle').textContent = phase.instructions;
            document.getElementById('guidanceText').textContent = phase.guidance;
            
            updateTimer();
            updateProgress();
            updatePhaseDots();
        }

        function updateTimer() {
            const mins = Math.floor(timeLeft / 60);
            const secs = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function updateProgress() {
            const totalDuration = phases.reduce((sum, phase) => sum + phase.duration, 0);
            const elapsed = phases.slice(0, currentPhase).reduce((sum, phase) => sum + phase.duration, 0) + (phases[currentPhase].duration - timeLeft);
            const progress = (elapsed / totalDuration) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function updatePhaseDots() {
            const dotsContainer = document.getElementById('phaseDots');
            dotsContainer.innerHTML = '';
            
            const checkSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20,6 9,17 4,12"/></svg>';
            
            phases.forEach((phase, index) => {
                const dot = document.createElement('button');
                dot.className = 'phase-dot';
                if (index === currentPhase) dot.classList.add('active');
                if (index < currentPhase) dot.classList.add('completed');
                dot.onclick = () => goToPhase(index);
                
                const iconHtml = index < currentPhase ? checkSvg : phase.iconSvgSmall;
                
                dot.innerHTML = `
                    <div class="phase-dot-icon">${iconHtml}</div>
                    <div class="phase-dot-number">${index + 1}</div>
                `;
                dotsContainer.appendChild(dot);
            });
        }

        function startTimer() {
            if (timeLeft === 0) {
                timeLeft = phases[currentPhase].duration;
            }
            
            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-flex';
            
            // Randomize start button text for next time
            const randomText = startButtonTexts[Math.floor(Math.random() * startButtonTexts.length)];
            document.getElementById('startBtn').innerHTML = `▶️ ${randomText}`;
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                updateProgress();
                
                if (timeLeft <= 0) {
                    if (currentPhase < phases.length - 1) {
                        nextPhase();
                    } else {
                        completeRitual();
                    }
                }
            }, 1000);
            
            // Play guidance for current phase
            const phase = phases[currentPhase];
            const guidance = currentPhase === 0 
                ? `Good morning. ${phase.instructions} ${phase.guidance}`
                : `${phase.instructions} ${phase.guidance}`;
            
            playVoice(guidance);
            
            console.log('⏰ Timer started for:', phase.name);
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timer);
            document.getElementById('startBtn').style.display = 'inline-flex';
            document.getElementById('pauseBtn').style.display = 'none';
            console.log('⏸️ Timer paused');
        }

        function resetTimer() {
            pauseTimer();
            currentPhase = 0;
            timeLeft = phases[0].duration;
            document.getElementById('app').style.display = 'block';
            document.getElementById('completion').style.display = 'none';
            updateDisplay();
            console.log('🔄 Timer reset');
        }

        function nextPhase() {
            currentPhase++;
            timeLeft = phases[currentPhase].duration;
            updateDisplay();
            
            const phase = phases[currentPhase];
            playVoice(`${phase.instructions} ${phase.guidance}`);
            
            console.log('➡️ Moving to phase:', phase.name);
        }

        function goToPhase(index) {
            if (!isRunning) {
                currentPhase = index;
                timeLeft = phases[index].duration;
                updateDisplay();
                console.log('🎯 Jumped to phase:', phases[index].name);
            }
        }

        function completeRitual() {
            pauseTimer();
            
            // Update day count
            dayCount++;
            localStorage.setItem('resetChallengeDays', dayCount.toString());
            
            // Show completion screen
            document.getElementById('app').style.display = 'none';
            document.getElementById('completion').style.display = 'block';
            
            // Update completion message
            const randomMessage = completionMessages[Math.floor(Math.random() * completionMessages.length)];
            document.getElementById('completionMessage').textContent = `${randomMessage} This is day ${dayCount} of your journey.`;
            
            // Fetch celebration content
            fetchCelebrationGif();
            
            // Play completion message
            const completionAudio = `${randomMessage} This is day ${dayCount} of your 30-day journey.`;
            playVoice(completionAudio);
            
            console.log('🎉 Ritual completed! Day', dayCount);
        }

        function resetForTomorrow() {
            resetTimer();
            updateDayCounter();
        }

        function shareProgress() {
            const shareText = `Day ${dayCount} of my 30-Day Reset Challenge! 🌅 Taking time each morning to show up with intention. Who's joining me? #30DayReset #SelfCare #WakeUpAndRise`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Wake Up and Rise - 30-Day Challenge',
                    text: shareText
                }).then(() => {
                    console.log('📱 Shared successfully');
                }).catch(err => {
                    console.log('📱 Share failed:', err);
                });
            } else if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Progress copied to clipboard! 📋');
                    console.log('📋 Copied to clipboard');
                }).catch(() => {
                    alert('Unable to copy. Share manually: ' + shareText);
                });
            } else {
                alert('Share this: ' + shareText);
            }
        }
    </script>
</body>
</html>
